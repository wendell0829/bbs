{% from "common/macros.html" import static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>注册</title>
    <script src="http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
    <link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="{{ static("common/js/csrf_ajax.js") }}"></script>
    <script src="{{ static("common/js/add_params.js") }}"></script>
    <link rel="stylesheet" href="{{ static("common/sweetalert/sweetalert.css") }}">
    <script src="{{ static("common/sweetalert/sweetalert.min.js") }}"></script>
    <script src="{{ static("common/sweetalert/myalert.js") }}"></script>
    <style>
        body {
            background-color: #494f60;
        }
        .out-box {
            background-color: white;
            margin: 0 auto;
            margin-top: 40px;
            overflow: hidden;
            width: 500px;
        }
        .logo-box{
            text-align: center;
            padding-top: 50px;
        }
        .form-box{
            margin: 0 auto;
            width: 300px;
            padding-top: 50px;
        }
        .page-title{
            text-align: center;
            padding-top: 20px;
            padding-bottom: 20px;
        }
        .signin-btn{
            padding-left: 78px;
        }
        .img-captcha-img{
            height: 32px;
            width: 94px;
            cursor: pointer;
        }
        .img-captcha-addon{
            overflow: hidden;
            padding: 0;
        }
    </style>
    <script>
        $(function () {
            $('#img-captcha-img').click(function (event) {
                event.preventDefault();
                var img = $(this);
                var src = img.attr("src");
                var src_new = param.setParam(src, "cnumber", Math.random());
                img.attr("src", src_new)
            });
            $('#sms-captcha-btn').click(function (event) {
                event.preventDefault();
                var self = $(this);
                var mobile = $("input[name=mobile]").val();
                var patt = /^1[3-9]\d{9}/;
                if (patt.test(mobile)){
                     csrf_ajax.post({
                    'url': '/common/sms_captcha/?mobile='+mobile,
                    'data': {
                        'mobile': mobile,
                    },
                    'success': function (data) {
                        // code==200
                        // code != 200
                        var message = data['message'];
                        if (data['code'] === 200) {
                            myalert.alertSuccessToast(message);
                        } else {
                            myalert.alertInfo(message);
                        }
                    },
                    'fail': function (error) {
                        myalert.alertNetworkError();
                    }
                })
                }
                else {
                    myalert.alertInfo('请填写正确格式的手机号码')
                }

            });

            $("#submit-btn").click(function (event) {
                event.preventDefault();
                var mobile_input = $("input[name='mobile']");
                var sms_captcha_input = $("input[name='sms_captcha']");
                var username_input = $("input[name='username']");
                var password1_input = $("input[name='password1']");
                var password2_input = $("input[name='password2']");
                var img_captcha_input = $("input[name='img_captcha']");

                var mobile = mobile_input.val();
                var sms_captcha = sms_captcha_input.val();
                var username = username_input.val();
                var password1 = password1_input.val();
                var password2 = password2_input.val();
                var img_captcha = img_captcha_input.val();

                csrf_ajax.post({
                    'url': '/signup/',
                    'data':{
                        'mobile': mobile,
                        'username': username,
                        'password1': password1,
                        'password2':password2,
                        'sms_captcha': sms_captcha,
                        'img_captcha': img_captcha
                    },
                    'success': function (data) {
                        var msg = data['message'];
                        if(data['code'] === 200){
                            myalert.alertSuccessToast(msg)
                        }
                        else{
                            myalert.alertInfoToast(msg)
                        }
                    },
                    'fail': function () {
                        myalert.alertNetworkError()
                    }
                })
            })
        });

    </script>
</head>
<body>
    <div class="out-box">
        <div class="logo-box">
            <img src="https://v3.bootcss.com/favicon.ico" alt="" class="logo-img">
        </div>
        <h2 class="page-title">
            欢迎来到注册页面
        </h2>
        <div class="form-box">
            <div class="form-group">
                <div class="input-group">
                    <input class="form-control" type="text" id="mobile" name="mobile" placeholder="手机号">
                    <span class="input-group-btn">
                        <button id="sms-captcha-btn" class="btn btn-default">发送验证码</button>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <input type="text" class="form-control" name="sms_captcha" placeholder="短信验证码">
            </div>
            <div class="form-group">
                <input class="form-control" type="text" id="username" name="username" placeholder="昵称">
            </div>
            <div class="form-group">
                <input class="form-control" type="password" id="password1" name="password1" placeholder="密码">
            </div>
            <div class="form-group">
                <input class="form-control" type="password" id="password2" name="password2" placeholder="请再次输入密码">
            </div>
            <div class="form-group">
                <div class="input-group">
                    <input class="form-control" type="text" id="img-captcha" name="img_captcha" placeholder="验证码">
                    <span id="img-captcha-btn" class="input-group-addon img-captcha-addon">
                        <img id="img-captcha-img" class="img-captcha-img" src="{{ url_for('common.graph_captcha') }}" alt="">
                    </span>
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <button id="submit-btn" class="btn btn-warning ">立即注册</button>
                    <span class="signin-btn">
                        <button id="submit-btn" class="btn btn-warning ">已有账号?去登录!</button>
                    </span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>